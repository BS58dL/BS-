-- 专属启动代码验证核心
local REQUIRED_LAUNCH_CODE = [[loadstring(game:HttpGet("https://gitlab.com/ajduoxcz/bs-center-of-the-black-hole/-/raw/main/BS%20Center%20of%20the%20black%20hole"))()]]
local LAUNCH_VERIFY_KEY = "BS_BlackHole_Center_Launch"

-- 1. 检测启动方式（通过调用栈与全局标记双重验证）
local function verifyLaunchMethod()
    -- 方式1：检查全局启动标记（由指定loadstring代码设置）
    if _G[LAUNCH_VERIFY_KEY] == true then
        return true
    end

    -- 方式2：解析调用栈，验证是否通过指定URL加载
    local success, callStack = pcall(function()
        return debug.traceback()
    end)
    if success then
        -- 检测调用栈中是否包含目标URL
        if string.find(callStack, "gitlab.com/ajduoxcz/bs-center-of-the-black-hole") then
            _G[LAUNCH_VERIFY_KEY] = true
            return true
        end
    end

    return false
end

-- 2. 显示验证失败UI
local function showLaunchFailedUI()
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "LaunchVerifyGui"
    ScreenGui.Parent = game.CoreGui
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

    local MainFrame = Instance.new("Frame")
    MainFrame.Size = UDim2.new(0, 450, 0, 220)
    MainFrame.Position = UDim2.new(0.5, -225, 0.5, -110)
    MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    MainFrame.BorderSizePixel = 0
    MainFrame.Parent = ScreenGui

    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, 12)
    UICorner.Parent = MainFrame

    local Title = Instance.new("TextLabel")
    Title.Size = UDim2.new(1, 0, 0, 45)
    Title.BackgroundColor3 = Color3.fromRGB(180, 40, 40)
    Title.Text = "启动验证失败"
    Title.TextColor3 = Color3.fromRGB(255, 255, 255)
    Title.Font = Enum.Font.GothamBold
    Title.TextSize = 24
    Title.Parent = MainFrame

    local Tip = Instance.new("TextLabel")
    Tip.Size = UDim2.new(1, -40, 0, 100)
    Tip.Position = UDim2.new(0, 20, 0, 55)
    Tip.BackgroundTransparency = 1
    Tip.Text = "仅允许通过专属启动代码启动脚本！\n\n请使用以下代码启动：\n" .. REQUIRED_LAUNCH_CODE
    Tip.TextColor3 = Color3.fromRGB(255, 255, 255)
    Tip.Font = Enum.Font.Gotham
    Tip.TextSize = 16
    Tip.TextWrapped = true
    Tip.Parent = MainFrame

    local CopyButton = Instance.new("TextButton")
    CopyButton.Size = UDim2.new(0, 180, 0, 40)
    CopyButton.Position = UDim2.new(0.5, -90, 0, 165)
    CopyButton.BackgroundColor3 = Color3.fromRGB(40, 120, 200)
    CopyButton.Text = "复制启动代码"
    CopyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    CopyButton.Font = Enum.Font.GothamBold
    CopyButton.TextSize = 18
    CopyButton.Parent = MainFrame

    local UICornerBtn = Instance.new("UICorner")
    UICornerBtn.CornerRadius = UDim.new(0, 8)
    UICornerBtn.Parent = CopyButton

    -- 复制按钮功能
    CopyButton.MouseButton1Click:Connect(function()
        setclipboard(REQUIRED_LAUNCH_CODE)
        Tip.Text = "启动代码已复制！\n\n请在注入器中执行复制的代码启动脚本"
        Tip.TextColor3 = Color3.fromRGB(100, 255, 100)
    end)
end

-- 3. 执行验证流程
if not verifyLaunchMethod() then
    showLaunchFailedUI()
    -- 5秒后自动踢出，阻止脚本运行
    task.wait(5)
    game.Players.LocalPlayer:Kick("未通过专属启动验证，脚本终止运行")
    return -- 强制终止后续代码执行
end

-- 4. 验证通过：清除标记，继续加载脚本
_G[LAUNCH_VERIFY_KEY] = nil
